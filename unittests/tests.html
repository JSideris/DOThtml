<!doctype html>

<html>
<link rel="stylesheet" type="text/css" href="bootstrap.min.css" />
<link rel="stylesheet" type="text/css" href="bootstrap-theme.min.css" />
<link rel="stylesheet" type="text/css" href="style.css" />

<script src="jquery.js"></script>
<script src="bootstrap.min.js"></script>
<script src="../dothtml.js"></script>

<body>
	<div class="container">
		<h1>Summary</h1>
		<div id="summary">Passed: <span id="summary-passed">0</span> Failed: <a id="summary-failed" href="#firstfail">0</a> Total: <span id="summary-total">0</span></div>
		<div id="defineproperty-not-supported" style="color: red;display:none;">- Two-way data binding tests will fail because this browser does not support getters/setters in Object.defineProperty. Only one-way binding will work. This is a work in progress.</div>
		<div id="jquery-not-supported" style="color: red;display:none;">- Tests for jQuery convenience wrappers could not be run because this browser does not support jQuery.</div>
		<br />
		<div>Version: <span id="version-out">???</span></div>
		<h1>Tests</h1>
		<p>Note: This test library is dependent on timing. If the timing tests are failing, it may be because your device is too slow or unable to handle numerous simutaneous JavaScript timeouts. Some browsers also add spaces in weird places which may result in false negatives.</p>
		<table class="table table-striped table-bordered">
			<thead>
				<tr>
					<th>Test Description</th>
					<th>DOT Markup</th>
					<th>Expected</th>
					<th>Result</th>
					<th>Pass/Fail</th>
				</tr>
			</thead>
			<tbody id="tests">
				<tr><td colspan="5"><b><i>Core Functionality</i></b></td></tr>
				<tr>
					<td>Write to target.</td>
					<td class="code">dot("#test1").empty().h("PASS");</td>
					<td class="code">N/A</td>
					<td id="test1results" class="code">N/A</td>
					<td id="test1" class="pending">PENDING</td>
				</tr>
				<tr>
					<td>Write to Node.</td>
					<td class="code">dot(document.getElementById("test2")).empty().h("PASS");</td>
					<td class="code">N/A</td>
					<td id="test2results" class="code">N/A</td>
					<td id="test2" class="pending">PENDING</td>
				</tr>
				<tr>
					<td>Write to NodeList.</td>
					<td class="code">dot(document.getElementById("test3")).empty().h("PASS");</td>
					<td class="code">N/A</td>
					<td id="test3results" class="code">N/A</td>
					<td id="test3" class="pending test3and4">PENDING</td>
				</tr>
				<!-- <tr>
					<td>Write to NodeList 2.</td>
					<td class="code">dot(document.getElementById("test4")).empty().h("PASS");</td>
					<td class="code">N/A</td>
					<td id="test4results" class="code">N/A</td>
					<td id="test4" class="pending test3and4">PENDING</td>
				</tr> -->
				<tr>
					<td>Has all tags supported by browser.</td>
					<td class="code">N/A</td>
					<td class="code">N/A</td>
					<td id="test5results" class="code">N/A</td>
					<td id="test5" class="pending">PENDING</td>
				</tr>
			</tbody>
		</table>
	</div>
	<script>
		var totalTests = 0;
		var testsPassed = 0;
		var testsFailed = 0;
		var firstFailSet = false;

		window.location.hash = "";
		//document.body.scrollTop = 0;
		setTimeout(()=>{window.location.hash = "firstfail";},1000);

		function formatHTML(html){
			html = html.toLowerCase();
			var html2 = "";
			for(var i = 0; i < html.length; i++){
				var chr = html.charAt(i);
				var chrC = chr.charCodeAt(0);
				if(chrC >= 32 && chrC <= 126){
					html2 += chr;
				}
			}
			html = html2;
			html = html.split("=\"disabled\"").join("");
			html = html.split(" value=\"\"").join("");
			html = html.split(" type=submit").join("");
			html = html.split("\"").join("");
			return html;
		}
		
		function updateScore(){
			document.getElementById("summary-passed").innerHTML = testsPassed;
			document.getElementById("summary-failed").innerHTML = testsFailed;
			document.getElementById("summary-total").innerHTML = totalTests;
		}
		
		function getAllTagNames(){
			var names = [];
			if(Object.getOwnPropertyNames){
				for(var k in Object.getOwnPropertyNames(window)){
					var name = k;
					if(name.indexOf("HTML") === 0 && name.indexOf('Element') != -1 && Object.getPrototypeOf(window[name]) == HTMLElement){
						var tag = name.substr(4, name.length - 11).toLowerCase();
						if(tag !== "unknown") names.push();
					}
				}
			}
			return names;
		}
		
		(function(){
			//MANUAL TESTING FOR APPEND/WRITE
			var t1 = document.getElementById("test1");
			var t2 = document.getElementById("test2");
			var t3 = document.getElementById("test3");
			var t4 = document.getElementById("test4");
			var t5 = document.getElementById("test5");
			try {
				totalTests++;
				dot("#test1").empty().h("PASS");
				if(t1.innerHTML != "PASS") throw "Writing 'PASS' resulted in: " + t1.innerHTML;
				t1.className = "pass";
				testsPassed++;
			}
			catch(err) {
				document.getElementById("test1results").innerHTML = err;
				t1.className = "fail";
				t1.innerHTML = "FAIL";
				testsFailed++;
			}
			try {
				totalTests++;
				dot(document.getElementById("test2")).empty().h("PASS");
				if(t2.innerHTML != "PASS") throw "Writing 'PASS' resulted in: " + t2.innerHTML;
				t2.className = "pass";
				testsPassed++;
			}
			catch(err) {
				document.getElementById("test2results").innerHTML = err;
				t2.className = "fail";
				t2.innerHTML = "FAIL";
				testsFailed++;
			}
			try {
				totalTests++;
				dot(document.querySelectorAll(".test3and4")).empty().h("PASS");
				if(t3.innerHTML != "PASS") throw "Writing 'PASS' resulted in: " + t3.innerHTML;
				t3.className = "pass";
				testsPassed++;
			}
			catch(err) {
				document.getElementById("test3results").innerHTML = err;
				t3.className = "fail";
				t3.innerHTML = "FAIL";
				testsFailed++;
			}
			// try{
			// 	totalTests++;
			// 	if(("#test4").html() != "PASS") throw "Writing 'PASS' resulted in: " + ("#test4").html();
			// 	("#test4").removeClass("pending");
			// 	("#test4").addClass("pass");
			// 	testsPassed++;
			// }
			// catch(err){
				// document.getElementById("test4results").innerHTML = err;
				// t4.className = "fail";
				// t4.innerHTML = "FAIL";
				// testsFailed++;
			// }
			try {
				totalTests++;
				var names = getAllTagNames();
				for(var i = 0; i < names.length; i++){
					var name = names[i];
					if(!dot[name]){
						throw "Tag name " + name + " is not supported."
					}
				}
				dot(document.querySelectorAll("#test5")).empty().h("PASS");
				t5.className = "pass";
				testsPassed++;
			}
			catch(err) {
				document.getElementById("test5results").innerHTML = err;
				t5.className = "fail";
				t5.innerHTML = "FAIL";
				testsFailed++;
			}
			updateScore();
			try{document.getElementById("version-out").innerHTML = dot.version;}
			catch(err){console.log(err);}

			if(!window.jQuery) document.getElementById("jquery-not-supported").style.display = "block";
			try{Object.defineProperty(new Object(), "value", { enumerable: true,get: function(){},set: function(value){}});}
			catch(e){document.getElementById("defineproperty-not-supported").style.display = "block";}
		
			function addHeader(title){
				dot("#tests").tr(
					dot.td(title).style("font-weight: bold; font-style: italic;").colspan(5)
				);
			}
		
			function addTest(description, test, expected, testTimeout){
				var resultHtml;
				try{
					var testResult = test();
				}
				catch(err){
					console.error(err);
					resultHtml = err.message;
					testTimeout = 0;
				}
				
				var testContents = test.toString();
				
				if(!testTimeout) testTimeout = 0;
				
				//Add the row first.
				var tr = dot("#tests").tr().getLast();
				
				setTimeout(function(){
					if(!testResult && !resultHtml) resultHtml = "Test did not return dot.";
					else if(!resultHtml) resultHtml = testResult._document ? testResult._document.innerHTML : "";

					var processedResult = formatHTML(resultHtml);
					var testExpected = "";
		
					var testPassed = false;
					if(expected instanceof Array){
						for(var i = 0; i < expected.length; i++){
							var testExpected = formatHTML(expected[i]);
							if(processedResult == testExpected) {
								testPassed = true;
							}
							else{
								testPassed = true;
								break;
							}
						}
					}
					else{
						testExpected = formatHTML(expected);
						if(testExpected == processedResult) testPassed = true;
					}
		
					totalTests++;
					var testNumber = totalTests;

					dot(tr) .td(dot.h(description)).id("test" + testNumber)
							.td(dot.t(testContents.slice(testContents.indexOf("return") + 7, testContents.lastIndexOf("}"))))["class"]("code")
							.td(dot.t(expected))["class"]("code")
							.td(dot.t(resultHtml))["class"]("code")
							.td(testPassed ? "PASS" : "FAIL")["class"](testPassed ? "pass" : "fail");
					
					if(testPassed) testsPassed++;
					else {
						testsFailed++;
						if(!firstFailSet) {
							firstFailSet = true;
							setTimeout(function(){
								dot("#test" + testNumber).a().name("firstfail");
							},0);
						}
					}
					
					updateScore();
				}, testTimeout);
			}
			//Writing/Appending
			
			//Basic functionality
			addHeader("Basic Functionality");
			addTest("Nothing.", function(){ return dot; }, "");
			addTest("Write text.", function(){ return dot.h(1); }, "1");
			addTest("Write 2 texts.", function(){ return dot.h(1).h(2); }, "12");
			addTest("Write HTML.", function(){ return dot.h("<div></div>"); }, "<div></div>");
			addTest("Escape HTML.", function(){ return dot.t("<div></div>"); }, "&lt;div&gt;&lt;/div&gt;");
			addTest("Div.", function(){ return dot.div(); }, "<div></div>");
			addTest("Number in a div.", function(){ return dot.div(1); }, "<div>1</div>");
			addTest("String in a div.", function(){ return dot.div("1"); }, "<div>1</div>");
			addTest("Boolean in a div.", function(){ return dot.div(true); }, "<div>true</div>");
			addTest("JSON object in a div.", function(){ return dot.div({}); }, "<div></div>");
			addTest("Function in a div.", function(){ return dot.div(function(){return dot.h(1)}) }, "<div>1</div>");
			addTest("HTML in a div.", function(){ return dot.div("<div></div>"); }, "<div><div></div></div>");
			addTest("Nested content.", function(){ return dot.div(dot.div(1)); }, "<div><div>1</div></div>");
			addTest("Side by side divs.", function(){ return dot.div().div(); }, "<div></div><div></div>");
			addTest("Side by side w/ content.", function(){ return dot.div(1).div(2); }, "<div>1</div><div>2</div>");
			addTest("Outside the box.", function(){ return dot.h(1).div(2).h(3); }, "1<div>2</div>3");
			addTest("Irregular nesting.", function(){ 
				return dot.h(1)
				.div(2)
				.h(3)
				.div(
					dot.h(4)
					.div(5)
					.h(6)
					.div(dot.div(7))
					.h(8)
				).h(9); }, "1<div>2</div>3<div>4<div>5</div>6<div><div>7</div></div>8</div>9");
			addTest("Class.", function(){ return dot.div()["class"](1); }, "<div class=\"1\"></div>");
			addTest("2nd class.", function(){ return dot.div().div()["class"](2).div(); }, "<div></div><div class=\"2\"></div><div></div>");
			addTest("Failing class.", function(){ return dot.h(1)["class"](2); }, "1");
			addTest("In class.", function(){ return dot.div(dot["class"](1)); }, "<div class=\"1\"></div>");
			addTest("Wrong class.", function(){ return dot.div(dot.h("2")["class"](1)); }, "<div>2</div>");
			addTest("Wrong class 2.", function(){ return dot.h(dot["class"](1).h(2)); }, "2");
			addTest("Classception.", function(){ return dot.div(dot.div(dot["class"](1))); }, "<div><div class=\"1\"></div></div>");
			addTest("Classception.", function(){ return dot.div(dot.h(dot["class"](1).h(2))); }, "<div>2</div>");
			addTest("Classception - parallel classy divs.", function(){ return dot.div([dot.div(dot["class"](1)), dot.div(dot["class"](2))]); }, "<div><div class=\"1\"></div><div class=\"2\"></div></div>");
			addTest("One class at a time.", function(){ return dot.div(dot["class"](1)); }, "<div class=\"1\"></div>");
			addTest("Skipped class.", function(){ return dot.div().h(1)["class"](2); }, "<div></div>1");
			addTest("Missed class.", function(){ return dot["class"](1); }, "");
			//addTest("Conflicting classes.", function(){ return dot.div(dot)["class"](1)["class"](2); }, "<div class=\"2\"></div>"); // DEPRECATED
			addTest("Conflicting classes.", function(){ return dot.div(dot)["class"](1)["class"](2); }, "<div class=\"1 2\"></div>");
			addTest("Void element.", function(){ return dot.img(); }, "<img>");
			addTest("Self-explaining attribute.", function(){ return dot.button().disabled(); }, "<button disabled=\"disabled\"></button>");
			addTest("Not a self-explaining attribute..", function(){ return dot.input().value(""); }, "<input value=\"\">");
			addTest("Passing dot to h.", function(){ return dot.h(dot.div()); }, "<div></div>");
			addTest("Passing function to h.", function(){ return dot.h(function(){return "<div></div>"}); }, "<div></div>");
			addTest("Two internal attributes.", function(){ return dot.div(dot["class"]("1").id("two-internal-attributes")); }, "<div class=\"1\" id=\"two-internal-attributes\"></div>");
			
			//Array evalutation.
			addHeader("Array Evaluation");
			addTest("Evaluate array.", function(){ return dot.div([1, 2, 3, 4]); }, "<div>1234</div>");
			addTest("Evaluate array of functions..", function(){ return dot.div([function(){return 1}, function(){return 2}]); }, "<div>12</div>");
			addTest("Evaluate array of dot.", function(){ return dot.div([dot.div(1), dot.div(2), dot.div(3), dot.div(4)]); }, "<div><div>1</div><div>2</div><div>3</div><div>4</div></div>");
			addTest("Evaluate array of dot into h.", function(){ return dot.h([dot.div(1), dot.div(2), dot.div(3), dot.div(4)]); }, "<div>1</div><div>2</div><div>3</div><div>4</div>");
			
			//Ignore undefined (like functions that hane no return, etc).
			addHeader("Undefined");
			addTest("Undefined div.", function(){ return dot.div(undefined) }, "<div></div>");
			addTest("Undefined html.", function(){ return dot.h(undefined) }, ""); //On the fence about this.
			addTest("Undefined text.", function(){ return dot.t(undefined) }, "undefined"); //If the user really wants to print out undefined.
			
			//Special tags.
			addHeader("Special Tags");
			addTest("citeE.", function(){ return dot.citeE(); }, "<cite></cite>");
			addTest("dataE.", function(){ return dot.dataE(); }, "<data></data>"); //Element not supported by most browsers.
			addTest("formE.", function(){ return dot.formE(); }, "<form></form>");
			addTest("labelE.", function(){ return dot.labelE(); }, "<label></label>");
			addTest("spanE.", function(){ return dot.spanE(); }, "<span></span>");
			addTest("summaryE.", function(){ return dot.summaryE(); }, "<summary></summary>");
			addTest("citeA.", function(){ return dot.del().citeA(1); }, "<del cite=\"1\"></del>");
			addTest("dataA.", function(){ return dot.object().dataA(1); }, "<object data=\"1\"></object>");
			addTest("formA.", function(){ return dot.input().formA(1); }, "<input form=\"1\">");
			addTest("labelA.", function(){ return dot.track().labelA(1); }, ["<track label=\"1\">", "<track label=\"1\"></track>"]);
			addTest("spanA.", function(){ return dot.col().spanA(1); }, "<col span=\"1\">");
			addTest("summaryA.", function(){ return dot.table().summaryA(1); }, "<table summary=\"1\"></table>");
			addTest("Smart cite - attribute.", function(){ return dot.del().cite(1); }, "<del cite=\"1\"></del>");
			addTest("Smart form - attribute.", function(){ return dot.input().form(1); }, "<input form=\"1\">");
			addTest("Smart label - attribute.", function(){ return dot.track().label(1); }, ["<track label=\"1\">", "<track label=\"1\"></track>"]);
			addTest("Smart span - attribute.", function(){ return dot.col().span(1); }, "<col span=\"1\">");
			addTest("Smart summary - attribute.", function(){ return dot.table().summary(1); }, "<table summary=\"1\"></table>");
			addTest("Smart cite - element.", function(){ return dot.div().cite(); }, "<div></div><cite></cite>");
			addTest("Smart form - element.", function(){ return dot.div().form(); }, "<div></div><form></form>");
			addTest("Smart label - element.", function(){ return dot.div().label(); }, "<div></div><label></label>");
			addTest("Smart span - element.", function(){ return dot.div().span(); }, "<div></div><span></span>");
			addTest("Smart summary - element.", function(){ return dot.div().summary(); }, "<div></div><summary></summary>");
			addTest("Smart cite - append to blank.", function(){ return dot.citeE(); }, "<cite></cite>");
			addTest("Smart form - append to blank.", function(){ return dot.formE(); }, "<form></form>");
			addTest("Smart label - append to blank.", function(){ return dot.labelE(); }, "<label></label>");
			addTest("Smart span - append to blank.", function(){ return dot.spanE(); }, "<span></span>");
			addTest("Smart summary - append to blank.", function(){ return dot.summaryE(); }, "<summary></summary>");
			addTest("Smart data - basic attribute.", function(){ return dot.object().data(1); }, "<object data=\"1\"></object>");
			addTest("Smart data - custom attribute.", function(){ return dot.div().data("a", 1); }, "<div data-a=\"1\"></div>");
		
			//If statements.
			addHeader("If Statements");
			addTest("Conditional true.", function(){ return dot.h(1).IF(true, dot.h("true")).h(2); }, "1true2");
			addTest("Conditional false.", function(){ return dot.h(1).IF(false, dot.h("false")).h(2); }, "12");
			addTest("Conditional true true.", function(){ return dot.h(1).IF(true, dot.h(2)).IF(true, dot.h(3)).h(4); }, "1234");
			addTest("Conditional class.", function(){ return dot.div(1).IF(true, dot["class"](2)); }, "<div class=\"2\">1</div>");
			//Not sure if the following two cases should be supported. They are broken as of 1.3.0, but I don't know if that matters.
			//addTest("Conditional deep class.", function(){ return dot.div(1).IF(true, dot.IF(true, dot["class"](2))); }, "<div class=\"2\">1</div>");
			//addTest("Conditional deep class with more confusion.", function(){ return dot.div(1).IF(true, dot.IF(true, dot["class"](2)).div(3)); }, "<div class=\"2\">1</div><div>3</div>");
			
			//Logic.
			addHeader("Logic");
			addTest("If true else.", function(){ return dot.IF(true, "if").ELSE("else"); }, "if");
			addTest("If false else.", function(){ return dot.IF(false, "if").ELSE("else"); }, "else");
			addTest("If false else else.", function(){ return dot.IF(false, "if").ELSE("else1").ELSE("else2"); }, "else1else2");
			addTest("If true elseif true else.", function(){ return dot.IF(true, "if").ELSEIF(true, "elseif").ELSE("else"); }, "if");
			addTest("If true elseif false else.", function(){ return dot.IF(true, "if").ELSEIF(false, "elseif").ELSE("else"); }, "if");
			addTest("If false elseif true else.", function(){ return dot.IF(false, "if").ELSEIF(true, "elseif").ELSE("else"); }, "elseif");
			addTest("If false elseif false else.", function(){ return dot.IF(false, "if").ELSEIF(false, "elseif").ELSE("else"); }, "else");
			addTest("Nested ifs.", function(){ 
			return dot.IF(true,
					dot.IF(false, "if if")
					.ELSEIF(true, "if elseif")
					.ELSE("if else")
				).ELSEIF(true, "elseif")
				.ELSE("else"); 
			}, "if elseif");
			
			//Truthiness
			addHeader("Truthiness");
			addTest("If null.", function(){ return dot.IF(null, "if").ELSE("else"); }, "else");
			addTest("If {}.", function(){ return dot.IF({}, "if").ELSE("else"); }, "if");
			
			//Iterations
			addHeader("Iterations");
			addTest("Iterate.", function(){ return dot.iterate(3, function(i){return dot.h(i)}); }, "012");
			addTest("Iterate w/ friends.", function(){ return dot.h("s").iterate(3, function(i){return dot.h(i)}).h("f"); }, "s012f");
			addTest("Iterate no return.", function(){ return dot.h("s").iterate(3, function(i){dot.h(i)}).h("f"); }, "sf");
			addTest("Iterate raw dot.", function(){ return dot.h("s").iterate(3, dot.h("-")).h("f"); }, "s---f");
			addTest("Iterate raw dot HTML.", function(){ return dot.h("s").iterate(3, dot.div()).h("f"); }, "s<div></div><div></div><div></div>f");
			addTest("Iterate text.", function(){ return dot.h("s").iterate(3, "-").h("f"); }, "s---f");
			addTest("Nested iterate.", function(){ 
				return dot.h("s")
				.iterate(2, function(i){
					return dot.iterate(2, function(j){return j})
				}).h("f"); 
			}, "s0101f");
			addTest("Each.", function(){ return dot.each([0, 1, 2], function(x){return x}); }, "012");
			addTest("Nested each.", function(){ return dot.each([0, 1, 2], function(x){return dot.h(x).each([3, 4, 5], function(y){return y})}); }, "034513452345");
			
			//Get Last Node
			addHeader("Get Last Node");
			addTest("Get Last Node.", function(){ return dot.h(dot.div("text").lastNode.innerHTML)}, "text");
			addTest("Get Last Node - h.", function(){ return dot.h(dot.h("<div>text</div>").lastNode.innerHTML)}, "text");
			addTest("Using getLast() function.", function(){ return dot.h(dot.div("text").getLast().innerHTML)}, "text");
			
			//Components
			addHeader("Components");
			try{
				dot.component("component_select", function(){return dot.select(dot.option("a").value("a").option("b").value("b").option("c").value("c"));});
		
				dot.component("comp_legacy", function(){return dot.div(dot.div(1))});
				dot.component({name: "comp_std", builder: function(){return dot.div(dot.div(1))}});
				dot.component({name: "comp_ready", builder: function(){return dot.div(dot.div(1))}, ready: function(){this.$el.innerHTML = "OKAY"}});
				dot.component({name: "comp_text", builder: function(){return "1"}});
				dot.component({name: "comp_textreplace", builder: function(){return "1"}, ready: function(){this.$el.parentNode.insertBefore(document.createTextNode("2"), this.$el.nextSibling);this.$el.parentNode.removeChild(this.$el);}});
				
				dot.component({name: "comp_binding_write", 
					builder: function(input, v1, v2){
						this.v1 = v1; 
						this.v2 = v2; 
						return input.bindTo(this, "v2");
					},
					ready: function(){ 
						var v = dot(this.$el).getVal(); 
						dot(this.$el.parentNode).empty()
						.div("Var: " + this.v2)
						.div("Input: " + v);
					}
				});
				dot.component({name: "comp_binding_var_change", 
					builder: function(input, v1, v2){
						this.v1 = v1; 
						this.v2 = v2; 
						return input.bindTo(this, "v1");
					},
					ready: function(){ 
						this.v1 = this.v2; 
						var v = dot(this.$el).getVal(); 
						dot(this.$el.parentNode).empty()
						.div("Var: " + this.v1)
						.div("Input: " + v);
					}
				});

				dot.component({name: "comp_binding_input_change", 
					builder: function(input, v1, v2){
						this.v1 = v1; 
						this.v2 = v2; 
						//this.myValue = dot.binding(v1); 
						return input.bindTo(this, "v1");
					},
					ready: function(){ 
						dot(this.$el).setVal(this.v2); 
						var v = dot(this.$el).getVal(); 
						this.$el.dispatchEvent(new Event("change"));
						//this.v1 = v; 
						dot(this.$el.parentNode).empty()
						.div("Var: " + this.v1)
						.div("Input: " + v); 
					}
				});
		
				dot.component("comp_binding_write_input", function(){return dot.comp_binding_write(dot.input(), "a", "b")});
				dot.component("comp_binding_var_change_input", function(){return dot.comp_binding_var_change(dot.input(), "a", "b")});
				dot.component("comp_binding_input_change_input", function(){return dot.comp_binding_input_change(dot.input(), "a", "b")});
				dot.component("comp_binding_write_textarea", function(){return dot.comp_binding_write(dot.textarea("x"), "a", "b")});
				dot.component("comp_binding_var_change_textarea", function(){return dot.comp_binding_var_change(dot.textarea("x"), "a", "b")});
				dot.component("comp_binding_input_change_textarea", function(){return dot.comp_binding_input_change(dot.textarea("x"), "a", "b")});
				dot.component("comp_binding_write_checkbox_on", function(){return dot.comp_binding_write(dot.input().type("checkbox"), false, true)});
				dot.component("comp_binding_var_change_checkbox_on", function(){return dot.comp_binding_var_change(dot.input().type("checkbox"), false, true)});
				dot.component("comp_binding_input_change_checkbox_on", function(){return dot.comp_binding_input_change(dot.input().type("checkbox"), false, true)});
				dot.component("comp_binding_write_checkbox_off", function(){return dot.comp_binding_write(dot.input().type("checkbox").checked(), true, false)});
				dot.component("comp_binding_var_change_checkbox_off", function(){return dot.comp_binding_var_change(dot.input().type("checkbox").checked(), true, false)});
				dot.component("comp_binding_input_change_checkbox_off", function(){return dot.comp_binding_input_change(dot.input().type("checkbox").checked(), true, false)});
				dot.component("comp_binding_write_radio_on", function(){return dot.comp_binding_write(dot.input().type("radio").name("radiotest1"), false, true)});
				dot.component("comp_binding_var_change_radio_on", function(){return dot.comp_binding_var_change(dot.input().type("radio").name("radiotest2"), false, true)});
				dot.component("comp_binding_input_change_radio_on", function(){return dot.comp_binding_input_change(dot.input().type("radio").name("radiotest3"), false, true)});
				dot.component("comp_binding_write_radio_off", function(){return dot.comp_binding_write(dot.input().type("radio").name("radiotest4"), true, false)});
				dot.component("comp_binding_var_change_radio_off", function(){return dot.comp_binding_var_change(dot.input().type("radio").name("radiotest5"), true, false)});
				dot.component("comp_binding_input_change_radio_off", function(){return dot.comp_binding_input_change(dot.input().type("radio").name("radiotest6"), true, false)});
				dot.component("comp_binding_write_select", function(){return dot.comp_binding_write(dot.component_select(), "a", "b")});
				dot.component("comp_binding_var_change_select", function(){return dot.comp_binding_var_change(dot.component_select(), "a", "b")});
				dot.component("comp_binding_input_change_select", function(){return dot.comp_binding_input_change(dot.component_select(), "a", "b")});
				// dot.component("comp_binding_write_option", function(){return dot.comp_binding_write(dot.input(),  false, true)});
				// dot.component("comp_binding_var_change_option", function(){return dot.comp_binding_var_change(dot.input(),  false, true)});
				// dot.component("comp_binding_input_change_option", function(){return dot.comp_binding_input_change(dot.input(),  false, true)});
				dot.component({name: "comp_binding_write_option", 
					builder: function(){ 
						this.myValue = true; 
						return dot.select(
							dot.option("a").value("a").selected()
							.option("b").value("b").bindTo(this, "myValue")
							.option("c").value("c"))
					},
					ready: function(){ 
						var v = dot(this.$el).getVal(); 
						dot(this.$el.parentNode).empty()
						.div("Var: " + this.myValue).div("Input: " + v) 
					}
				});
				dot.component({name: "comp_binding_var_change_option", 
					builder: function(){ 
						this.myValue = false;
						return dot.select(
							dot.option("a").value("a").selected()
							.option("b").value("b").bindTo(this, "myValue")
							.option("c").value("c"))
						},
					ready: function(){ 
						this.myValue = true; 
						var v = dot(this.$el).getVal(); 
						dot(this.$el.parentNode).empty()
						.div("Var: " + this.myValue)
						.div("Input: " + v) 
					}
				});

				// TODO: not sure if this is a valid test case.
				// The change event is dispatched on the option element, not the select.
				// Need to ensure this works with real elements and user interaction.
				dot.component({name: "comp_binding_input_change_option", 
					builder: function(){ 
						this.myValue = false; 
						return dot.select(
							dot.option("a").value("a").selected()
							.option("b").value("b").bindTo(this, "myValue")
							.option("c").value("c"))},
					ready: function(){ 
						dot(this.$el).setVal("b"); 
						//this.myValue.setFrom(this.$el.childNodes[1]); 
						var v = dot(this.$el).getVal(); 
						this.$el.children[1].dispatchEvent(new Event("change"));
						dot(this.$el.parentNode).empty()
						.div("Var: " + this.myValue)
						.div("Input: " + v); 
					}
				});

				// Testing $el
				dot.component("comp_el_undefined_el", function(){});
				dot.component("comp_el_zero_el", function(){return dot});
				dot.component("comp_el_one_el", function(){return dot.div("abc")});
				dot.component("comp_el_two_el", function(){return dot.div("abc").div("abc")});
				dot.component("comp_el_deferred_el", function(){return dot.div("abc").wait(function(){}, 1000)});
				dot.component("comp_el_text_zero_el", function(){return "abc"});
				dot.component("comp_el_text_one_el", function(){return "<div>abc</div>"});
				dot.component("comp_el_text_two_el", function(){return "<div>abc</div><div>123</div>"});
		
			}catch(e){ console.error(e);}
			addTest("Std params component.", function(){return dot.comp_std()}, "<div><div>1</div></div>");
			addTest("Std params component, nested.", function(){return dot.div(2).comp_std().div(3)}, "<div>2</div><div><div>1</div></div><div>3</div>");
			addTest("Std prams component beside markup.", function(){return dot.h(2).comp_std().h(3)}, "2<div><div>1</div></div>3");
			addTest("Legacy params component.", function(){return dot.comp_legacy()}, "<div><div>1</div></div>");
			addTest("Component w/ ready method.", function(){return dot.comp_ready()}, "<div>OKAY</div>");
			addTest("Text component.", function(){return dot.h("a").comp_text().h("b")}, "a1b");
			addTest("Text component w/ ready method.", function(){return dot.h("a").comp_textreplace().h("b")}, "a2b");
			addTest("Undefined $el.", function(){try{return dot.comp_el_undefined_el()}catch(e){return dot.span(e)}}, "<span>Component 'comp_el_undefined_el' must return exactly one child node.</span>");
			addTest("Zero $el.", function(){try{return dot.comp_el_zero_el()}catch(e){return dot.span(e)}}, "<span>Component 'comp_el_zero_el' must return exactly one child node.</span>");
			addTest("One $el.", function(){return dot.comp_el_one_el()}, "<div>abc</div>");
			addTest("Two $el.", function(){try{return dot.comp_el_two_el()}catch(e){return dot.span(e)}}, "<span>Component 'comp_el_two_el' must return exactly one child node.</span>");
			addTest("Deferred $el.", function(){try{return dot.comp_el_deferred_el()}catch(e){return dot.span(e)}}, "<span>Component 'comp_el_deferred_el' must return exactly one child node.</span>");
			addTest("One $el.", function(){return dot.comp_el_text_zero_el()}, "abc");
			addTest("One $el.", function(){return dot.comp_el_text_one_el()}, "<div>abc</div>");
			addTest("Undefined $el.", function(){try{return dot.comp_el_text_two_el()}catch(e){return dot.span(e)}}, "<span>Component 'comp_el_text_two_el' must return exactly one child node.</span>");
			
			addHeader("Component Data Bindings");
			addTest("Var bound to input.", function(){return dot.comp_binding_write_input()}, "<div>Var: b</div><div>Input: b</div>");
			addTest("Var change updating input.", function(){return dot.comp_binding_var_change_input()}, "<div>Var: b</div><div>Input: b</div>");
			addTest("Input change updating var.", function(){return dot.comp_binding_input_change_input()}, "<div>Var: b</div><div>Input: b</div>");
			addTest("Var bound to textarea.", function(){return dot.comp_binding_write_textarea()}, "<div>Var: b</div><div>Input: b</div>");
			addTest("Var change updating textarea.", function(){return dot.comp_binding_var_change_textarea()}, "<div>Var: b</div><div>Input: b</div>");
			addTest("Textarea change updating var.", function(){return dot.comp_binding_input_change_textarea()}, "<div>Var: b</div><div>Input: b</div>");
			addTest("Var bound to checkbox on.", function(){return dot.comp_binding_write_checkbox_on()}, "<div>Var: true</div><div>Input: true</div>");
			addTest("Var change updating checkbox on.", function(){return dot.comp_binding_var_change_checkbox_on()}, "<div>Var: true</div><div>Input: true</div>");
			addTest("Checkbox change updating var on.", function(){return dot.comp_binding_input_change_checkbox_on()}, "<div>Var: true</div><div>Input: true</div>");
			addTest("Var bound to checkbox off.", function(){return dot.comp_binding_write_checkbox_off()}, "<div>Var: false</div><div>Input: false</div>");
			addTest("Var change updating checkbox off.", function(){return dot.comp_binding_var_change_checkbox_off()}, "<div>Var: false</div><div>Input: false</div>");
			addTest("Checkbox change updating var.", function(){return dot.comp_binding_input_change_checkbox_off()}, "<div>Var: false</div><div>Input: false</div>");
			addTest("Var bound to radio on.", function(){return dot.comp_binding_write_radio_on()}, "<div>Var: true</div><div>Input: true</div>");
			addTest("Var change updating radio on.", function(){return dot.comp_binding_var_change_radio_on()}, "<div>Var: true</div><div>Input: true</div>");
			addTest("Radio change updating var on.", function(){return dot.comp_binding_input_change_radio_on()}, "<div>Var: true</div><div>Input: true</div>");
			addTest("Var bound to radio off.", function(){return dot.comp_binding_write_radio_off()}, "<div>Var: false</div><div>Input: false</div>");
			addTest("Var change updating radio off.", function(){return dot.comp_binding_var_change_radio_off()}, "<div>Var: false</div><div>Input: false</div>");
			addTest("Radio change updating var off.", function(){return dot.comp_binding_input_change_radio_off()}, "<div>Var: false</div><div>Input: false</div>");
			addTest("Var bound to select.", function(){return dot.comp_binding_write_select()}, "<div>Var: b</div><div>Input: b</div>");
			addTest("Var change updating select.", function(){return dot.comp_binding_var_change_select()}, "<div>Var: b</div><div>Input: b</div>");
			addTest("Select change updating var.", function(){return dot.comp_binding_input_change_select()}, "<div>Var: b</div><div>Input: b</div>");
			addTest("Var bound to option.", function(){return dot.comp_binding_write_option()}, "<div>Var: true</div><div>Input: b</div>");
			addTest("Var change updating option.", function(){return dot.comp_binding_var_change_option()}, "<div>Var: true</div><div>Input: b</div>");
			addTest("Option change updating var.", function(){return dot.comp_binding_input_change_option()}, "<div>Var: true</div><div>Input: b</div>");
			
			//Routing
			addHeader("Routing");
			try{
				dot.component("defaultpage", function(){return dot.h1("Default")});
				dot.component("page1", function(){return dot.h1("Page 1.")});
				dot.component("page2", function(){return dot.h1("Page 2.")});
				dot.component("page3", function(){return dot.h1("Page 3.").router()});
				dot.component("page4", function(){return dot.h1("Good.")});
				dot.component("page5", function(){return dot.h1("Bad.")});
				dot.component("page6_7", function(){return dot.h1("Page 6/7.")});
				dot.component("page6", function(){return dot.h1("Page 6.")});
				dot.component("page7", function(){return dot.h1("Page 7.")});
				dot.component("awesomepage", function(params){return dot.h1(params.params.title).p(params.params.body)});
				dot.component("notfound", function(){return dot.h1("Not Found.")});
			}catch(e){console.error(e);}
			var routes = [
				{title: "DOT Tests", path: "/", component: dot.defaultpage},
				{title: "Page 1", path: "1", component: dot.page1},
				{title: "Page 2", path: "2", component: dot.page2},
				{title: "Page 3", path: "3", component: dot.page3},
				{title: "Greedy Page 4", path: "greed", component: dot.page4},
				{title: "Greedy Page 5", path: "greed", component: dot.page5},
				{title: "Page 6/7", path: "6/7", component: dot.page6_7},
				{title: "Awesome", path: "awesome/{title}/{body}", component: dot.awesomepage},
				{title: "Ajax", path: "ajax", component: "testpage.js"},
				{title: "Not Found", path: "*", component: dot.notfound},
			];
			// addTest("Navigate with no router.", function(){return dot.div("abc").navigate("1")}, "<div>abc</div>");
			// addTest("Chainability of navigate.", function(){return dot.div("abc").navigate("1").div("def")}, "<div>abc</div><div>def</div>");
			// addTest("Default content.", function(){return dot.router(routes, true)}, "<dothtml-router></dothtml-router>");
			// addTest("Default content, undefined navigate.", function(){return dot.router(routes, true).navigate()}, "<dothtml-router><h1>Default</h1></dothtml-router>");
			// addTest("Default content, / navigate.", function(){return dot.router(routes, true).navigate("/")}, "<dothtml-router><h1>Default</h1></dothtml-router>");
			// addTest("Unknown route.", function(){return dot.router(routes, true).navigate("unknown")}, "<dothtml-router><h1>Not Found.</h1></dothtml-router>");
			// addTest("Navigate to 1.", function(){return dot.router(routes, true).navigate("1")}, "<dothtml-router><h1>Page 1.</h1></dothtml-router>");
			// addTest("Navigate to 1/.", function(){return dot.router(routes, true).navigate("1/")}, "<dothtml-router><h1>Page 1.</h1></dothtml-router>");
			// addTest("Navigate to 1 then 2.", function(){return dot.router(routes, true).navigate("1").navigate("2")}, "<dothtml-router><h1>Page 2.</h1></dothtml-router>");
			// addTest("Navigate to the same page.", function(){return dot.router(routes, true).navigate("1").navigate("1")}, "<dothtml-router><h1>Page 1.</h1></dothtml-router>");
			// addTest("Navigate from 1 to undefined.", function(){return dot.router(routes, true).navigate("1").navigate()}, "<dothtml-router><h1>Default</h1></dothtml-router>");
			// addTest("Navigate from 1 to /.", function(){return dot.router(routes, true).navigate("1").navigate("/")}, "<dothtml-router><h1>Default</h1></dothtml-router>");
			// addTest("Navigate to 6/7.", function(){return dot.router(routes, true).navigate("6/7")}, "<dothtml-router><h1>Page 6/7.</h1></dothtml-router>");
			// addTest("Navigate to 6/8.", function(){return dot.router(routes, true).navigate("6/8")}, "<dothtml-router><h1>Not Found.</h1></dothtml-router>");
			// addTest("Params.", function(){return dot.router(routes, true).navigate("awesome/Hello/Hello_World")}, "<dothtml-router><h1>Hello</h1><p>Hello_World</p></dothtml-router>");
			// addTest("Greedy route.", function(){return dot.router(routes, true).navigate("greed")}, "<dothtml-router><h1>Good.</h1></dothtml-router>");
			// addTest("Load page file.", function(){return dot.router(routes, true).navigate("ajax")}, "<dothtml-router><h1>Loaded Page</h1><p>This page was loaded from a file!</p></dothtml-router>");
			// NESTED ROUTING (NOT SUPPORTED YET)
			// addTest("Route not found child.", function(){return dot.router(routes, true).navigate("3/notfound")}, "<dothtml-router><h1>Page 3.</h1><dothtml-router>Route \"notfound\" not found.</dothtml-router></dothtml-router>");
			// addTest("Router in router / default.", function(){return dot.router(routes, true).navigate("3")}, "<dothtml-router><h1>Page 3.</h1><dothtml-router><h1>Default</h1></dothtml-router></dothtml-router>");
			// addTest("Router in router / page 3/1.", function(){return dot.router(routes, true).navigate("3/1")}, "<dothtml-router><h1>Page 3.</h1><dothtml-router><h1>Page 1.</h1></dothtml-router></dothtml-router>");
			// addTest("Router in router / page 3/2 => 3/1.", function(){return dot.router(routes, true).navigate("3/2").navigate("3/1")}, "<dothtml-router><h1>Page 3.</h1><dothtml-router><h1>Page 1.</h1></dothtml-router></dothtml-router>");
			// addTest("Router in router / page 3/2 => 2.", function(){return dot.router(routes, true).navigate("3/1").navigate("2")}, "<dothtml-router><h1>Page 2.</h1></dothtml-router>");
			// addTest("Router in router / page 2 => 3/1.", function(){return dot.router(routes, true).navigate("2").navigate("3/1")}, "<dothtml-router><h1>Page 3.</h1><dothtml-router><h1>Page 1.</h1></dothtml-router></dothtml-router>");
			// addTest("Router in router / page 3/3/1.", function(){return dot.router(routes, true).navigate("3/3/1")}, "<dothtml-router><h1>Page 3.</h1><dothtml-router><h1>Page 3.</h1><dothtml-router><h1>Page 1.</h1></dothtml-router></dothtml-router></dothtml-router>");
			// CURRENTLY UNDEFINED:
			//addTest("Two routers.", function(){return dot.router(routes, true).router(routes, true).navigate("1")}, "<dothtml-router></dothtml-router><dothtml-router><h1>Page 1.</h1></dothtml-router>");
 			// - Add test case for ensuring routers are removed from the allRouters object after calling empty().

			//jQuery wrappers
			if(window.jQuery){
				addHeader("jQuery Wrappers");
				addTest("jQuery, set CSS.", function(){return dot.div().$css("color", "black");}, "<div style=\"color: black;\"></div>");
				addTest("jQuery, reset CSS.", function(){return dot.div().$css("color", "black").$css("color", "red");}, "<div style=\"color: red;\"></div>");
				addTest("jQuery, set CSS on h.", function(){return dot.h(1).$css("color", "black");}, "1");
				addTest("jQuery, set CSS inside h.", function(){return dot.h(dot.$css("color", "black").h(1));}, "1");
				addTest("jQuery, set CSS inside h 2.", function(){return dot.div(dot.h(dot.$css("color", "black").h(1)));}, "<div>1</div>");
				addTest("jQuery, set CSS inside div.", function(){return dot.div(dot.$css("color", "black"));}, "<div style=\"color: black;\"></div>");
				addTest("jQuery, set CSS inside nested div.", function(){return dot.div(dot.div(dot.$css("color", "black")));}, "<div><div style=\"color: black;\"></div></div>");
				addTest("jQuery, set CSS.", function(){return dot.div().$css("color", "black");}, "<div style=\"color: black;\"></div>");
			}
			
			//Scripted
			addHeader("Scripted");
			//The expected functionality of these test cases changed in version 1.3.0.
			addTest("Script, no return.", function(){ return dot.script(function(){1 + 1;}).div(1); }, "<div>1</div>");
			addTest("Script, return dot.", function(){ return dot.script(function(){return 2;}).div(1); }, "<div>1</div>");
			addTest("Script, return function.", function(){ return dot.script(function(){return function(){return 2};}).div(1); }, "<div>1</div>");
			
			//jQuery helpers
			if(window.jQuery){
				addHeader("jQuery Helpers");
				addTest("jQuery hide.", function(){return dot.div().$hide()}, "<div style=\"display: none;\"></div>");
				addTest("jQuery hide slow.", function(){return dot.div().$hide(50)}, "<div style=\"display: none;\"></div>", 500);
				addTest("jQuery hide slow, callcack returns dot.", function(){return dot.div().$hide(50, function(){return dot.div()})}, "<div style=\"display: none;\"></div><div></div>", 500);
				addTest("jQuery hide slow, callcack returns dot, internal", 
					function(){
						return dot.div(dot.$hide(50, function(){
							return dot.div();
						}));
					}, "<div style=\"display: none;\"><div></div></div>", 500);
				addTest("jQuery hide slow, callcack is dot.", function(){return dot.div().$hide(50, dot.div())}, "<div style=\"display: none;\"></div><div></div>", 500);
				addTest("jQuery hide slow, callcack is dot, internal.", function(){return dot.div(dot.$hide(50, dot.div()));}, "<div style=\"display: none;\"><div></div></div>", 500);
				addTest("jQuery hide slow, callcack is dot, internal, after div.", function(){return dot.div(dot.div().$hide(50, dot.div()));}, "<div><div style=\"display: none;\"></div><div></div></div>", 500);
			}
			
			//Wait
			addHeader("Async");
			
			addTest("Deferred.", function(){ return dot.div(dot.defer(function(v){v.h(1)}))}, "<div>1</div>");
			addTest("Long deferred.", function(){ return dot.div(dot.defer(function(v){setTimeout(function(){v.h(1);},0)})); }, "<div>1</div>", 500);
			
			addTest("Wait, timing early.", function(){ return dot.div(1).wait(620, dot.div(3)).div(2); }, "<div>1</div><dothtml-defer></dothtml-defer><div>2</div>", 500);
			addTest("Wait, for nothing.", function(){ return dot.div(1).wait(50, function(){}).div(2); }, "<div>1</div><div>2</div>", 500);
			addTest("Wait, for a string.", function(){ return dot.div(1).wait(50, "3").div(2); }, "<div>1</div>3<div>2</div>", 500);
			addTest("Wait, for a div.", function(){ return dot.div(1).wait(50, dot.div(3)).div(2); }, "<div>1</div><div>3</div><div>2</div>", 500);
			addTest("Wait, inside a div.", function(){ return dot.div(1).div(dot.wait(50, dot.div(3))).div(2); }, "<div>1</div><div><div>3</div></div><div>2</div>", 500);
			addTest("Wait, for class.", function(){ return dot.div(1).wait(50, dot["class"](3)).div(2); }, "<div class=\"3\">1</div><div>2</div>", 500);
			addTest("Wait, for class 2.", function(){ return dot.div(dot.div(1).wait(50, dot["class"](3)).div(2)); }, "<div><div class=\"3\">1</div><div>2</div></div>", 500);
			addTest("Wait, for class, internal.", function(){ return dot.div(dot.wait(50, dot["class"](3))).div(2); }, "<div class=\"3\"></div><div>2</div>", 500);
			addTest("Wait, for a function.", function(){ return dot.div(1).wait(50, function(){return dot.div(3)}).div(2); }, "<div>1</div><div>3</div><div>2</div>", 500);
			addTest("Wait, append to nothing.", function(){ return dot.wait(50, dot.div(3)); }, "<div>3</div>", 500);
			addTest("Wait, append to nothing, concat 2.", function(){ return dot.wait(50, dot.div(3)).h(2); }, "<div>3</div>2", 500);
			addTest("Wait, append between text nodes.", function(){ return dot.h(1).wait(50, dot.div(3)).h(2); }, "1<div>3</div>2", 500);
			addTest("Wait, out of order.", function(){ return dot.wait(20, dot.div(1)).wait(50, dot.div(2)).wait(30, dot.div(3)); }, "<div>1</div><div>2</div><div>3</div>", 500);
			addTest("Wait, iterate.", function(){ return dot.div(1).wait(50, dot.h("s").iterate(3, "-").h("f")).div(2); }, "<div>1</div>s---f<div>2</div>", 500);
			addTest("Waitception, early.", function(){ return dot.wait(50, dot.div(dot.wait(620, dot.div(1)))); }, "<div><dothtml-defer></dothtml-defer></div>", 500);
			addTest("Waitception, late, times shouldn't stack.", function(){ return dot.wait(80, dot.div(dot.wait(80, dot.div(1)))); }, "<div><div>1</div></div>", 500);
			addTest("Waitception, late, times stack for functions 1/2.", function(){ return dot.wait(300, function(){return dot.div(dot.wait(300, dot.div(1)))}); }, "<div><dothtml-defer></dothtml-defer></div>", 500);
			addTest("Waitception, late, times stack for functions 2/2.", function(){ return dot.wait(1, function(){return dot.div(dot.wait(1, dot.div(1)))}); }, "<div><div>1</div></div>", 500);
			//addTest("Waitception, late, deep class.", function(){ return dot.div().wait(10, dot.wait(10, dot["class"](1)))}, "<div class=\"1\"></div>", 500); //This one fails. Not sure if I should support it though.
			addTest("Waitception, late.", function(){ return dot.wait(10, dot.div(dot.wait(20, dot.div(1)))); }, "<div><div>1</div></div>", 500);
			addTest("Waitception, late, short inner interval.", function(){ return dot.wait(20, dot.div(dot.wait(10, dot.div(1)))); }, "<div><div>1</div></div>", 500);
			if(window.jQuery){
				addTest("Wait then $hide dot.", function(){return dot.div().wait(50, dot.$hide())}, "<div style=\"display: none;\"></div>", 500);
				addTest("Wait then $hide function.", function(){return dot.div().wait(50, function(){return dot.$hide()})}, "<div style=\"display: none;\"></div>", 500);
				addTest("Wait then $hide dot, internal.", function(){return dot.div(dot.wait(50, dot.$hide()))}, "<div style=\"display: none;\"></div>", 500);
			}
			/**/
		})();
		</script>
</body>
</html>